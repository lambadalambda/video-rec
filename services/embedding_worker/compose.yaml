services:
  embedding_worker:
    image: ${EMBEDDING_WORKER_IMAGE:-ghcr.io/OWNER/video-suggestion-embedding-worker:latest}
    ports:
      - "9001:9001"
    environment:
      UPLOADS_DIR: /unused
      EMBEDDING_BACKEND: ${EMBEDDING_BACKEND:-qwen3_vl}
      QWEN3_VL_MODEL: ${QWEN3_VL_MODEL:-Qwen/Qwen3-VL-Embedding-2B}
      QWEN_QUANTIZATION: ${QWEN_QUANTIZATION:-none}
      QWEN_DEVICE: ${QWEN_DEVICE:-auto}
      QWEN_MAX_LENGTH: ${QWEN_MAX_LENGTH:-8192}
      QWEN_BATCH_MAX_SIZE: ${QWEN_BATCH_MAX_SIZE:-1}
      QWEN_BATCH_WAIT_MS: ${QWEN_BATCH_WAIT_MS:-10}
      QWEN_VIDEO_TARGET_FRAMES: ${QWEN_VIDEO_TARGET_FRAMES:-10}
      QWEN_VIDEO_MAX_FRAMES: ${QWEN_VIDEO_MAX_FRAMES:-64}
      QWEN_VIDEO_FPS: ${QWEN_VIDEO_FPS:-1.0}
      EMBEDDING_DIMS: ${EMBEDDING_DIMS:-1536}
      TRANSCRIBE_ENABLED: ${TRANSCRIBE_ENABLED:-1}
      WHISPER_BACKEND: ${WHISPER_BACKEND:-transformers}
      WHISPER_MODEL: ${WHISPER_MODEL:-distil-whisper/distil-large-v3}
      WHISPER_DEVICE: ${WHISPER_DEVICE:-auto}
    volumes:
      - hf_cache:/root/.cache/huggingface
      - torch_cache:/root/.cache/torch
    restart: unless-stopped
    gpus: all

volumes:
  hf_cache:
  torch_cache:
